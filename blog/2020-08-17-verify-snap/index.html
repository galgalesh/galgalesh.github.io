<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Verifying the source of a Snap package - Merlijn Sebrechts</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.74.3" /><meta itemprop="name" content="Verifying the source of a Snap package">
<meta itemprop="description" content="Many Snap packages contain two files which allows users to verify what sources were used to build the package.
 snap/snapcraft.yaml is the &ldquo;source&rdquo; of the package. This file was used by Snapcraft to build the package. snap/manifest.yaml is a &ldquo;recording&rdquo; of the build of that package. It is similar to the first file, but it includes a lot more information to pinpoint what exact sources were being used. It records the exact package versions of dependencies, the git commit of all source repositories, checksums of any downloaded binary and more.">
<meta itemprop="datePublished" content="2020-08-16T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-08-16T00:00:00+00:00" />
<meta itemprop="wordCount" content="874">



<meta itemprop="keywords" content="Snap," />
<meta property="og:title" content="Verifying the source of a Snap package" />
<meta property="og:description" content="Many Snap packages contain two files which allows users to verify what sources were used to build the package.
 snap/snapcraft.yaml is the &ldquo;source&rdquo; of the package. This file was used by Snapcraft to build the package. snap/manifest.yaml is a &ldquo;recording&rdquo; of the build of that package. It is similar to the first file, but it includes a lot more information to pinpoint what exact sources were being used. It records the exact package versions of dependencies, the git commit of all source repositories, checksums of any downloaded binary and more." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2020-08-17-verify-snap/" />
<meta property="article:published_time" content="2020-08-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-16T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Verifying the source of a Snap package"/>
<meta name="twitter:description" content="Many Snap packages contain two files which allows users to verify what sources were used to build the package.
 snap/snapcraft.yaml is the &ldquo;source&rdquo; of the package. This file was used by Snapcraft to build the package. snap/manifest.yaml is a &ldquo;recording&rdquo; of the build of that package. It is similar to the first file, but it includes a lot more information to pinpoint what exact sources were being used. It records the exact package versions of dependencies, the git commit of all source repositories, checksums of any downloaded binary and more."/>

            <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/github.min.css">
          <link rel="stylesheet" href="/css/bundle.min.182747932867f43d8c875b59a0300848b838002d4008d4a5b8ddcc41a37c4cf7.css" integrity="sha256-GCdHkyhn9D2Mh1tZoDAISLg4AC1ACNSluN3MQaN8TPc="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          Merlijn Sebrechts
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
        
      
        
          
          <a href="/about/" class="nav link"><i class="far fa-id-card">&nbsp;</i>About</a>
        
      
        
          
          <a href="/nl/tanzania/" class="nav link"><i class="far fa-newspaper">&nbsp;</i>Tanzania (Dutch)</a>
        
      
        
          
          <a href="/categories/" class="nav link"><i class="fas fa-sitemap">&nbsp;</i>Categories</a>
        
      
      
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    
    <a href="#lang-menu" class="nav lang-toggle" lang="en">en</a>
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  <menu id="lang-menu" class="flyout-menu menu">
  <a href="#" lang="en" class="nav link active">English (en)</a>
  
    
      
    
      
        <a href="/nl" lang="nl" class="nav no-lang link">Nederlands (nl)</a>
      
    
  
</menu>

  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="/img/main/Merlijn%20Sebrechts100x100.jpg" class="circle" width="100" alt="Merlijn Sebrechts" /></a>
  <header>
    <h1>Merlijn Sebrechts</h1>
  </header>
  <main>
    <p>Let's talk meta!</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fas fa-rss"></a></li>


        <li><a href="//github.com/galgalesh/galgalesh.github.io" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//linkedin.com/in/merlijnsebrechts" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>























<li><a href="//orcid.org/0000-0002-4093-7338" target="_blank" rel="noopener" title="ORCID"><i class="ai ai-orcid"></i></a></li>



<li><a href="mailto:merlijn.sebrechts@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article class="post">
    <header>
  <div class="title">
    
      <h2><a href="/blog/2020-08-17-verify-snap/">Verifying the source of a Snap package</a></h2>
    
    
  </div>
  <div class="meta">
    <time datetime="2020-08-16 00:00:00 &#43;0000 UTC">August 16, 2020</time>
    
    
  </div>
</header>

    <div id="socnet-share">
      





    </div>
    <div class="content">
      
      <p>Many Snap packages contain two files which allows users to verify what sources were used to build the package.</p>
<ul>
<li><code>snap/snapcraft.yaml</code> is the &ldquo;source&rdquo; of the package. This file was used by Snapcraft to build the package.</li>
<li><code>snap/manifest.yaml</code> is a &ldquo;recording&rdquo; of the build of that package. It is similar to the first file, but it includes a lot more information to pinpoint what exact sources were being used. It records the exact package versions of dependencies, the git commit of all source repositories, checksums of any downloaded binary and more.</li>
</ul>
<p>The manifest is used by the Snap Store to check if Snap packages contain libraries with security vulnerabilities. If this is the case, the publisher gets an email asking them to rebuild the package.</p>
<p>Both these files are added by the <code>snapcraft</code> build tool when the environment variable <code>SNAPCRAFT_BUILD_INFO</code> is set during the build. This is automatically enabled for all snaps built by snapcraft.io and Launchpad.</p>
<h2 id="what-do-the-manifests-contain">What do the manifests contain?</h2>
<p>Let&rsquo;s look at Canonical&rsquo;s Chromium snap as an example. If you&rsquo;ve already installed the snap</p>
<p>In <code>snap/snapcraft.yaml</code>, <code>source</code> explains what repository is used to build the package and <code>stage-packages</code> describe what dependencies are included in the snap.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"> <span style="color:#66d9ef">desktop-gtk3</span>:
    <span style="color:#66d9ef">source</span>: https://github.com/ubuntu/snapcraft-desktop-helpers.git
    <span style="color:#66d9ef">source-subdir</span>: gtk
    <span style="color:#66d9ef">stage-packages</span>:
      - libxkbcommon0
      - ttf-ubuntu-font-family
      - shared-mime-info
...
</code></pre></div><p>In <code>snap/manifest.yaml</code>, <code>source-commit</code> is added to narrow down what exact source was used for this package and <code>stage-packages</code> include the exact version of each dependency.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"> <span style="color:#66d9ef">desktop-gtk3</span>:
    <span style="color:#66d9ef">source</span>: https://github.com/ubuntu/snapcraft-desktop-helpers.git
    <span style="color:#66d9ef">source-commit</span>: 622e2aa7a840b3a7dbb6ea4d432d687d5cc2e8ef
    <span style="color:#66d9ef">source-subdir</span>: gtk
    <span style="color:#66d9ef">stage-packages</span>:
    - libxkbcommon0=<span style="color:#ae81ff">0.8.2-1</span>~ubuntu18<span style="color:#ae81ff">.04.1</span>
    - ttf-ubuntu-font-family=<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">0.83-2</span>
    - shared-mime-info=<span style="color:#ae81ff">1.9-2</span>
...
</code></pre></div><p>Finally, for snaps built on Launchpad, <code>snap/manifest.yaml</code> also contains a URL to the build log.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">image-info</span>:
  <span style="color:#66d9ef">build-request-id</span>: lp<span style="color:#ae81ff">-58361925</span>
  <span style="color:#66d9ef">build-request-timestamp</span>: <span style="color:#e6db74">&#39;2020-08-05T11:55:18Z&#39;</span>
  <span style="color:#66d9ef">build_url</span>: https://launchpad.net/~osomon/+snap/chromium-snap-firstrun-notice/+build/<span style="color:#ae81ff">1071421</span>
</code></pre></div><h2 id="how-do-i-access-these-files">How do I access these files?</h2>
<p>Currently, you need to download the snaps before you can access the manifest.</p>
<ul>
<li>If you don&rsquo;t have the Snap installed, run <code>snap download snap-name</code>, which will download the snap to the current directory. You can then open the snap with any archive manager to look at the files.</li>
<li>If you have the snap installed, you can find them in <code>/snap/snap-name/current/snap/</code>.</li>
</ul>
<h2 id="can-the-manifests-be-doctored">Can the manifests be doctored?</h2>
<p>Yes; a malicious publisher can change the contents of these files. If the snap was built on Launchpad, however, you can verify if the manifest was changed since the package was built:</p>
<ol>
<li>Download the snap and look for the <code>build_url</code> in <code>snap/manifest.yaml</code>.</li>
<li>Surf to the URL and download the snap in &ldquo;Built files&rdquo;.</li>
<li>Calculate the checksum of both snaps and see if they match.</li>
</ol>
<p>If the checksums match, you know the manifest was not changed since the package was built. On Launchpad, you can also see which machine the package was built on, the entire build log and the source of that build.</p>
<blockquote>
<p>Note: This process requires you to trust the information in Launchpad is correct. This is the same infrastructure that builds the regular Ubuntu packages and hosts their source code, however, so Ubuntu and all of its derivatives already depend on this information being correct.</p>
</blockquote>
<h2 id="can-i-trust-any-package-built-on-launchpad">Can I trust any package built on Launchpad?</h2>
<p>No! It is still very important to trust the <em>publisher</em> of a package themselves. Because the publisher controls the entire source code of the application, it is impossible to stop them from including malicious code. Even if that code is built on Launchpad.</p>
<blockquote>
<p>Note: for this reason, I don&rsquo;t think it&rsquo;s useful to force publishers to include manifests and/or use Launchpad. It would only give users a false sense of security.</p>
</blockquote>
<p>Snap is specifically designed to let developers publish their apps directly to users without a middleman. This also means that users should only install software from developers they trust. The Snap sandbox helps to reduce the damage a malicious or broken snap can do, but it does not completely protect you from harm.</p>
<h2 id="areas-of-improvement">Areas of improvement</h2>
<p>If you&rsquo;re interested in transparency, trust and reproducibility of snaps, there are many areas you can work on to further improve this. From the top of my head, these are some of the things that can improve:</p>
<ul>
<li>To see the manifest, users need to download the snap and manually look through the files. It would be very useful if the <a href="https://github.com/canonical-web-and-design/snapcraft.io">Snap Store web frontend</a> and the <a href="https://github.com/snapcore/snapd"><code>snap</code> CLI command</a> could show you the manifest and the data in it.</li>
<li>Although the manifest records everything used to build the package, you can&rsquo;t yet use this recording to reproduce the package. The <a href="https://github.com/snapcore/snapcraft"><code>snapcraft</code></a> build tool needs to be modified so it can rebuild a snap from the <code>manifest.yaml</code>. You won&rsquo;t be starting from scratch though, as <code>snapcraft</code> already supports many of the fields in the manifest.</li>
<li>The manifest currently does not contain the source url of the repository which contains the <code>snapcraft.yaml</code> file itself. You can use Launchpad to find this repository, but it would be better to include this repository in the manifest itself.</li>
<li>As far as I know, Launchpad is currently the only build service for Snaps which includes a link to the build log. It would be useful for others such as the <a href="build.neon.kde.org">KDE Neon build service</a> to do the same thing.</li>
</ul>
<blockquote>
<p>Note: I am a human being, and like most human beings, I make mistakes. Did you find an issue with this article? Let me know in the comments, and I&rsquo;ll be happy to correct it!</p>
</blockquote>

    </div>
    <footer>
      <div class="stats">
  
    <ul class="categories">
      
        
          <li><a class="article-terms-link" href="/categories/linux/">Linux</a></li>
        
      
    </ul>
  
  
    <ul class="tags">
      
        
          <li><a class="article-terms-link" href="/tags/snap/">Snap</a></li>
        
      
    </ul>
  
</div>

    </footer>
  </article>
  
    
  <article class="post">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "merlijn" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>




  
  <div class="pagination">
    
    
      <a href="/blog/2020-steampunk-cyborg-2/" class="button right"><span>How I became a cyborg pt2</span></a>
    
  </div>

      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent Posts</h1>
      </header>
      
      <article class="mini-post">
          
        <header>
          <h2><a href="/blog/2020-08-17-verify-snap/">Verifying the source of a Snap package</a></h2>
          <time class="published" datetime="2020-08-16 00:00:00 &#43;0000 UTC">August 16, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2020-steampunk-cyborg-2/" class="image" style="--bg-image: url('/img/2019/mechanical-valve.png');">
    <img src="/img/2019/mechanical-valve.png" alt="">
  </a>
        <header>
          <h2><a href="/blog/2020-steampunk-cyborg-2/">How I became a cyborg pt2</a></h2>
          <time class="published" datetime="2020-08-15 00:00:00 &#43;0000 UTC">August 15, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2020-08-02-why-one-snap-store/" class="image" style="--bg-image: url('/img/2020/snap-flatpak/snap-store.png');">
    <img src="/img/2020/snap-flatpak/snap-store.png" alt="">
  </a>
        <header>
          <h2><a href="/blog/2020-08-02-why-one-snap-store/">Why is there only one Snap Store?</a></h2>
          <time class="published" datetime="2020-08-02 00:00:00 &#43;0000 UTC">August 2, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2020-07-17-lgpl-copyleft-snaps/" class="image" style="--bg-image: url('/img/2020/snap-flatpak/snap-flatpak-gpl.png');">
    <img src="/img/2020/snap-flatpak/snap-flatpak-gpl.png" alt="">
  </a>
        <header>
          <h2><a href="/blog/2020-07-17-lgpl-copyleft-snaps/">Copyleft and LGPL in Snaps and Flatpaks</a></h2>
          <time class="published" datetime="2020-07-17 00:00:00 &#43;0000 UTC">July 17, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2020-07-06-why-snap-flatpak/" class="image" style="--bg-image: url('/img/2020/snap-flatpak/packaging.jpg');">
    <img src="/img/2020/snap-flatpak/packaging.jpg" alt="">
  </a>
        <header>
          <h2><a href="/blog/2020-07-06-why-snap-flatpak/">Why Linux desktop apps need containers</a></h2>
          <time class="published" datetime="2020-07-06 00:00:00 &#43;0000 UTC">July 6, 2020</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/blog/" class="button">See More</a>
        </footer>
      
    </section>
  

  
    
      <section id="categories">
        <header>
          <h1><a href="/categories">categories</a></h1>
        </header>
        <ul>
          
          
          <li>
              <a href="/categories/linux/">linux<span class="count">10</span></a>
          
          <li>
              <a href="/categories/health/">health<span class="count">2</span></a>
          
          <li>
              <a href="/categories/phd/">phd<span class="count">1</span></a>
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>Curious for more? <a href="/nl/">Check out the Dutch part of this blog.</a></p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fas fa-rss"></a></li>


        <li><a href="//github.com/galgalesh/galgalesh.github.io" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//linkedin.com/in/merlijnsebrechts" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>























<li><a href="//orcid.org/0000-0002-4093-7338" target="_blank" rel="noopener" title="ORCID"><i class="ai ai-orcid"></i></a></li>



<li><a href="mailto:merlijn.sebrechts@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    © 2020 Merlijn Sebrechts
      <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.74.3' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/html.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/css.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/js.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/toml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script><script src="/js/bundle.min.04e4331e7228ac2ae5ac38e52fa5be55170cb09168dfa97b6be0eedc1e2139b8.js" integrity="sha256-BOQzHnIorCrlrDjlL6W&#43;VRcMsJFo36l7a&#43;Du3B4hObg="></script>
    <script src="/js/add-on.js"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-172953075-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
  </body>
</html>
